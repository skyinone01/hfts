<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="Instructions" >
    <resultMap id="InstructionsXHMap" type="com.ug369.backend.service.entity.mysql.InstructionsXH">
        <result column="id" property="id" jdbcType="INTEGER"/>
        <result column="title" property="title" jdbcType="VARCHAR"/>
        <result column="orderIndex" property="orderIndex" jdbcType="INTEGER"/>
        <result column="levels" property="levels" jdbcType="INTEGER"/>
        <result column="imgUrl" property="imgUrl" jdbcType="VARCHAR"/>
        <result column="paths" property="paths" jdbcType="VARCHAR"/>
    </resultMap>

    <select id="selectXH" resultMap="InstructionsXHMap">
    select id,title,orderindex,levels,imgurl,paths from (
        SELECT id,title,`order` as orderindex,imgurl,
     @le:= IF (pid = 0 ,0,
         IF( LOCATE( CONCAT('|',pid,':'),@pathlevel)   > 0  ,
                  SUBSTRING_INDEX( SUBSTRING_INDEX(@pathlevel,CONCAT('|',pid,':'),-1),'|',1) +1
        ,@le+1) ) levels
     , @pathlevel:= CONCAT(@pathlevel,'|',id,':', @le ,'|') pathlevel
      , @pathnodes:= IF( pid =0,',0',
           CONCAT_WS(',',
           IF( LOCATE( CONCAT('|',pid,':'),@pathall) > 0  ,
               SUBSTRING_INDEX( SUBSTRING_INDEX(@pathall,CONCAT('|',pid,':'),-1),'|',1)
              ,@pathnodes ) ,pid  ) )paths
    ,@pathall:=CONCAT(@pathall,'|',id,':', @pathnodes ,'|') pathall
        FROM  yg_sys_instructions,
    (SELECT @le:=0,@pathlevel:='', @pathall:='',@pathnodes:='',@orders:='',@ordernodes:='') vv
    ORDER BY  pid,id
    ) src
    </select>
    
    <select id="getCount" resultType="int">
        SELECT COUNT(id)
        FROM yg_sys_instructions
    </select>
    
    
    <update id="update" parameterType="com.ug369.backend.service.entity.mysql.Instructions" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update yg_sys_instructions t
    <set >
      <if test="title != null" >
        t.title = #{title},
      </if>
      <if test="pid != null" >
        t.pid = #{pid},
      </if>
      <if test="order != null" >
        t.order = #{order},
      </if>
      <if test="content != null" >
        t.content = #{content},
      </if>
      <if test="imgUrl != null" >
        t.imgurl = #{imgUrl},
      </if>
      <if test="clientType != null" >
        t.clienttype = #{clientType},
      </if>
      <if test="status != null" >
        t.status = #{status},
      </if>
      <if test="createDate != null" >
        t.createdate = #{createDate},
      </if>
      <if test="remark != null" >
        t.remark = #{remark},
      </if>
    </set>
    where t.id = #{id}
  </update>
  
  <select id="findOne" resultType="com.ug369.backend.service.entity.mysql.Instructions" parameterType="java.lang.Long">
    SELECT t.id, t.title, t.pid, 
    t.order, t.content, t.imgurl, t.clienttype, 
    t.status, t.createdate, t.remark FROM yg_sys_instructions t 
    WHERE t.id = #{id}
  </select>
  
  <delete id="delete" parameterType="java.lang.Long" >
  	DELETE FROM yg_sys_instructions WHERE id = #{id}
  </delete>
  
  <insert id="add" parameterType="com.ug369.backend.service.entity.mysql.Instructions" >
  	INSERT INTO yg_sys_instructions 
		(
			<if test="title != null" >
			title,
			</if>
			<if test="pid != null" >
			pid,
			</if>
			<if test="order != null" >
			`order`,
			</if>
			<if test="imgUrl != null" >
			imgurl
			</if>
		)
	VALUES
		(
		<if test="title != null" >
			#{title},
			</if>
			<if test="pid != null" >
			#{pid},
			</if>
			<if test="order != null" >
			#{order},
			</if>
			<if test="imgUrl != null" >
			#{imgUrl}
			</if>
		)
  </insert>
</mapper>